<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>ê·¸ë¦¿ì—ë“€ í•™ìƒë³„ ê°•ì˜ JSON ìƒì„±ê¸° (ê´€ë¦¬ììš©)</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body { font-family: system-ui, sans-serif; max-width: 1000px; margin: 20px auto; padding: 0 20px; }
h1 { margin-bottom: 8px; }
table { width: 100%; border-collapse: collapse; margin-top: 12px; }
th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: left; font-size: 14px; }
th { background: #f9f9f9; }
input, textarea { font: inherit; }
textarea { width: 100%; height: 60px; resize: vertical; }
button { font: inherit; padding: 6px 10px; margin: 4px; border-radius: 6px; cursor: pointer; }
button.primary { background: #ff7a00; color: white; border: 1px solid #ff7a00; }
button.danger { background: #e74c3c; color: white; border: 1px solid #c0392b; }
#controls { display:flex; flex-wrap:wrap; gap:6px; margin-bottom:10px; }
pre { background:#f7f7f7; padding:10px; border-radius:8px; overflow:auto; font-size:13px; }
.note { color:#666; font-size:13px; }
</style>
</head>
<body>

<h1>ğŸ“š GRIT EDU í•™ìƒë³„ ê°•ì˜ JSON ìƒì„±ê¸°</h1>
<p class="note">ë¸Œë¼ìš°ì €ë§Œìœ¼ë¡œ í•™ìƒ ëª…ë‹¨ì„ ê´€ë¦¬í•˜ê³ , ê° í•™ìƒë³„ JSONì„ ìë™ ìƒì„±Â·ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div id="controls">
  <button id="addStudent">í•™ìƒ ì¶”ê°€</button>
  <button id="exportJSON" class="primary">ì „ì²´ JSON ZIP ë‹¤ìš´ë¡œë“œ</button>
  <button id="exportCSV">CSV(ì—‘ì…€) ë‚´ë³´ë‚´ê¸°</button>
  <button id="clearAll" class="danger">ì „ì²´ ì´ˆê¸°í™”</button>
</div>

<table id="table">
  <thead>
    <tr>
      <th>ì´ë¦„</th>
      <th>ì´ë©”ì¼(ì•„ì´ë””)</th>
      <th>ë¹„ê³ </th>
      <th>ê°•ì˜ ëª©ë¡<br><small>í•œ ì¤„ë‹¹ "ì œëª© | videoId"</small></th>
      <th>ì‚­ì œ</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<pre id="preview"></pre>

<script type="module">
import JSZip from "https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm";
const tableBody = document.querySelector("#table tbody");
const preview = document.getElementById("preview");

function loadData() {
  return JSON.parse(localStorage.getItem("grit_students") || "[]");
}
function saveData(data) {
  localStorage.setItem("grit_students", JSON.stringify(data));
  repaint();
}
function repaint() {
  const data = loadData();
  tableBody.innerHTML = "";
  data.forEach((s, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><input value="${s.name||""}" data-field="name" data-idx="${i}" placeholder="í™ê¸¸ë™"></td>
      <td><input value="${s.email||""}" data-field="email" data-idx="${i}" placeholder="ì•„ì´ë””ë§Œ ì…ë ¥ (ì˜ˆ: student1)">@gmail.com</td>
      <td><input value="${s.note||""}" data-field="note" data-idx="${i}" placeholder="ë¹„ê³ "></td>
      <td><textarea data-field="courses" data-idx="${i}" placeholder="ì˜ˆ) ë§›ë³´ê¸° 1 | 6aPYStft9Xo"></textarea></td>
      <td><button data-del="${i}" style="background:#f66;color:white;border:none;border-radius:6px;">X</button></td>
    `;
    tableBody.appendChild(tr);
    tr.querySelector("textarea").value = s.rawCourses || "";
  });
  preview.textContent = JSON.stringify(data, null, 2);
}
tableBody.addEventListener("input", e => {
  const f = e.target.dataset.field;
  const idx = Number(e.target.dataset.idx);
  const data = loadData();
  if (!data[idx]) return;
  data[idx][f] = e.target.value;
  if (f === "courses") data[idx].rawCourses = e.target.value;
  saveData(data);
});
tableBody.addEventListener("click", e => {
  const idx = e.target.dataset.del;
  if (idx !== undefined) {
    const data = loadData();
    data.splice(idx, 1);
    saveData(data);
  }
});

document.getElementById("addStudent").onclick = () => {
  const data = loadData();
  data.push({ name: "", email: "", note: "", rawCourses: "" });
  saveData(data);
};

document.getElementById("clearAll").onclick = () => {
  if (confirm("ëª¨ë“  í•™ìƒ ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?")) {
    localStorage.removeItem("grit_students");
    repaint();
  }
};

// ===== JSON / CSV ìƒì„± =====
function makeJSON(student) {
  const emailFull = (student.email||"").trim().toLowerCase() + "@gmail.com";
  const items = (student.rawCourses||"")
    .split(/\n+/)
    .map(line => {
      const [t, vid] = line.split("|").map(s=>s.trim());
      return (t && vid) ? { title:t, videoId:vid } : null;
    })
    .filter(Boolean);
  return {
    name: student.name,
    email: emailFull,
    note: student.note,
    courses: [{ title:"ì½”ìŠ¤", items }]
  };
}

// ===== ZIP ë‹¤ìš´ë¡œë“œ =====
document.getElementById("exportJSON").onclick = async () => {
  const zip = new JSZip();
  const data = loadData();
  if (!data.length) return alert("í•™ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
  for (const s of data) {
    const json = makeJSON(s);
    const fname = (s.name||s.email||"student") + ".json";
    zip.file(fname, JSON.stringify(json, null, 2));
  }
  const blob = await zip.generateAsync({ type:"blob" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "grit_students.zip";
  a.click();
  URL.revokeObjectURL(a.href);
};

// ===== CSV ë‚´ë³´ë‚´ê¸° =====
document.getElementById("exportCSV").onclick = () => {
  const data = loadData();
  if (!data.length) return alert("í•™ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
  const rows = [["ì´ë¦„","ì´ë©”ì¼(@gmail.com)","ë¹„ê³ ","ê°•ì˜ëª©ë¡"]];
  for (const s of data) {
    rows.push([
      s.name,
      (s.email||"")+"@gmail.com",
      s.note,
      (s.rawCourses||"").replace(/\n/g," / ")
    ]);
  }
  const csv = rows.map(r => r.map(v=>`"${(v||"").replace(/"/g,'""')}"`).join(",")).join("\n");
  const blob = new Blob([csv], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "grit_students.csv";
  a.click();
  URL.revokeObjectURL(a.href);
};

// ì´ˆê¸° ë Œë”
repaint();
</script>

</body>
</html>
